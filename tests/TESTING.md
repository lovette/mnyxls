# Testing

## Run tests

Tests are run by [*pytest*](https://docs.pytest.org/en/stable/). There is a `Makefile` target to run the test suite.

    make tests

## Test data

Sample transactions reports with random transactions can be generated with `gentestreports.py`.

    cd tests
    ./gentestreports.py --output testtxns.csv

## Test database

The SQLite database in `sample_reports` can be generated by running the test `test_reports.test_db_named`
after (temporarily) changing the `tmp_path` argument of `tmp_path_cwd` to `None`.
When the test is run, the generated `.sqlite3` database will be saved in the test directory and can
be moved to `sample_reports` and renamed.

## Result workbooks

The `expected_result.xlsx` workbook for each test can be generated by running each test
after (temporarily) changing the `tmp_path` argument of `create_and_compare_workbook` to `None`.
When the test is run, the generated `result.xlsx` workbook will be saved in the test directory and can
be renamed.

The `expected_result.xlsx` workbook for each test can be reset after test data is changed by setting
`RESET_EXPECTED_RESULT_XLS = True` in `testutils.py` module. This will overwrite the expected result
with the new result if it has the same structure (sheets and columns) as the current expected result.

## Test working directory

In order to keep the `tests` directory clean, the working directory for each test is set to `tmp_path`
that *pytest* provides as a fixture. Files generated by tests are saved in the working directory.
If you want to review generated files, you can pass `None` as the `tmp_path` argument to `tmp_path_cwd`
(which `create_and_compare_workbook` invokes.) An alternative, if you want *all tests* to save
results to its test directory, is to set `USE_TMP_PATH = False` in `testutils.py` module.

